# Advanced Firewall Example Configuration {.appendix .same-file}
The firewall rules modelled by `Device.Firewall.Chain.{i}`,  `Device.Firewall.DMZ.{i}` and `Device.Firewall.Pinhole.{i}` operate only on the forwarding path.
This means that they affect only routed traffic, and do not affect traffic that is destined for or generated by the device itself.

Traffic destined for or generated by the device itself SHOULD use the `Device.Firewall.Service.{i}` object to model the appropriate firewall rules.

Note that any NAT processing on the ingress packet occurs before firewall rules are applied so, for example,
the firewall rules will see the translated destination IP address and port in a downstream packet that has passed through the NAT.

## Config level
This section presents an advanced firewall example that illustrates settings corresponding to the following predefined `Firewall.Config` levels:

* **High**: The firewall implements the "Traffic Denied Inbound" and "Minimally Permit Common Services Outbound" components of the ICSA residential certification's Required Services Security Policy [@ICSA-Residential]. If DoS and vulnerability protections are implemented [@ICSA-Baseline], these are enabled.

* **Low**: All Outbound traffic and pinhole-defined Inbound traffic is allowed. If DoS and vulnerability protections are implemented [@ICSA-Baseline], these are enabled.

~~~~~~~

    Firewall.
        Enable = true
        Config = "Advanced"
        AdvancedLevel = Firewall.Level.1
        Type = "Stateful"
    Firewall.Level.1.
        Name = "High"
        Description = "Deny Inbound and minimally permit Outbound"
        Order = 1
        Chain = Firewall.Chain.1
        DefaultPolicy = "Drop"
    Firewall.Level.2.
        Name = "Low"
        Description = "Allow all Outbound and pinhole-defined Inbound"
        Order = 2
        Chain = Firewall.Chain.2
        DefaultPolicy = "Drop"
    Firewall.Chain.1.
        Name = "High (Deny Inbound and minimally permit Outbound)"
        Creator = "Defaults"
        Rule.1.
            Order = 1
            Description = "Telnet"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 6                     # TCP
            DestPort = 23
        Rule.2.
            Order = 2
            Description = "FTP"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 6                     # TCP
            DestPort = 21
        Rule.3.
            Order = 3
            Description = "HTTP"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 6                     # TCP
            DestPort = 80
        Rule.4.
            Order = 4
            Description = "HTTPS"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 6                     # TCP
            DestPort = 443
        Rule.5.
            Order = 5
            Description= "SMTP"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 6                     # TCP
            DestPort = 25
        Rule.6.
            Order = 6
            Description = "DNS"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 17                    # UDP
            DestPort = 53
        Rule.7.
            Order = 7
            Description = "POP3"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 6                     # TCP
            DestPort = 110
        Rule.8.
            Order = 8
            Description = "IMAP"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
            Protocol = 6                     # TCP
            DestPort = 143
    Firewall.Chain.2.
        Name = "Low (Allow all Outbound and pinhole-defined Inbound)"
        Creator = "Defaults"
        Rule.1.
            Order = 1
            Description = "Outbound"
            Target = "Accept"
            DestInterface = IP.Interface.1   # upstream facing IP interface
        Rule.2.
            Order = 2
            Description = "Allow IPsec AH"
            Target = "Accept"
            SourceInterface = IP.Interface.1 # upstream facing IP interface
            IPVersion = 6                    # IPv6
            Protocol = 51                    # AH
        Rule.3.
            Order = 3
            Description = "Allow IPsec ESP"
            Target = "Accept"
            SourceInterface = IP.Interface.1 # upstream facing IP interface
            IPVersion = 6                    # IPv6
            Protocol = 50                    # ESP
        Rule.4.
            Order = 4
            Description = "Allow IPsec key exchange"
            Target = "Accept"
            SourceInterface = IP.Interface.1 # upstream facing IP interface
            IPVersion = 6                    # IPv6
            Protocol = 17                    # UDP
            DestPort = 500
        Rule.5.
            Order = 5
            Description = "UPnP Port Mapping"
            Target = "TargetChain"
            TargetChain = Firewall.Chain.3
            SourceInterface = IP.Interface.1 # upstream facing IP interface
        Rule.6.
            Order = 6
            Description = "UPnP IPv6 Firewall"
            Target = "TargetChain"
            TargetChain = Firewall.Chain.4
            SourceInterface = IP.Interface.1 # upstream facing IP interface
        Rule.7.
            Order = 7
            Description = "User Interface"
            Target = "TargetChain"
            TargetChain = Firewall.Chain.5
            SourceInterface = IP.Interface.1 # upstream facing IP interface
    Firewall.Chain.3.
        Name = "UPnP Port Mapping (dynamic rules)"
        Creator = "PortMapping"
        Rule.1.
            Order = 1
            Description = "SSH"
            Target = "Accept"
            SourceInterface = IP.Interface.1 # upstream facing IP interface
            IPVersion = 4                    # IPv4
            Protocol = 6                     # TCP
            DestPort = 22
    Firewall.Chain.4.
        Name = "UPnP IPv6 Firewall (dynamic rules)"
        Creator = "WANIPv6FirewallControl"
        Rule.1.
            Order = 1
            Description = "HTTP"
            Target = "Accept"
            SourceInterface = IP.Interface.1 # upstream facing IP interface
            IPVersion = 6                    # IPv6
            Protocol = 6                     # TCP
            DestIP = 1080:0:0:800::1
            DestPort = 80
    Firewall.Chain.5.
        Name = "User Interface"
        Creator = "UserInterface"
        Rule.1.
            Order = 1
            Description = "SMTP server"
            Target = "Accept"
            SourceInterface = IP.Interface.1 # upstream facing IP interface
            IPVersion = 4                    # IPv4
            Protocol = 6                     # TCP
            DestIP = 192.168.1.4
            DestPort = 25
        Rule.2.
            Order = 2
            Description = "DMZ"
            Target = "Accept"
            SourceInterface = IP.Interface.1 # upstream facing IP interface
            IPVersion = 4                    # IPv4
            DestIP = "192.168.1.5"           # IPv4 address of LAN device that recvs
                                             # all unsolicited inbound IPv4 traffic
~~~~~~~

## Firewall policy
The firewall policy enables the definition of firewall rules for incoming and outgoing traffic. It defines the relation between source interface and destination interface and the reverse relation (between destination and source). In it simplest format it can be "Allow"/"Drop", but in most cases it is useful to define a firewall chain target for both directions.

In a multi WAN, multi LAN environment, the policy concept can greatly reduce the complexity of the firewall configuration.
It makes it easier to re-use firewall chains for different Interface configuration.

![Policy configuration example](/images/firewall-policy-example.svg)

In order to configure more complex scenarios the firewall Levels are extended with a reference to the corresponding policy (instead of the `Firewall.Chain.{i}.` reference.).

The policy mode can be enabled by setting the firewall config parameter to `Policy`.

~~~~~~~
    Firewall.Config = Policy
~~~~~~~

### Policy Level
The active firewall Level can be configured by referencing the `Firewall.PolicyLevel` parameter to one of the instantiated objects of the `Firewall.Level.{i}` table.

~~~~~~~
    Firewall.PolicyLevel = Firewall.Level.2
~~~~~~~

### Policy referencing
Each firewall Level can have its own set of policies. Policies can be configured by referencing the `Firewall.Level.{i}.Policies` parameter to one or more of the instantiated objects of the `Firewall.Policy.{i}` table.

Below are some examples of the firewall level configuration corresponding with the firewall levels `Low`, `Medium` and `High`.

**Firewall level Low**

~~~~~~~
    Firewall.Level.1
      Alias = "Low"
      Name = "Low"
      Policies = Firewall.Policy.1,Firewall.Policy.2,Firewall.Policy.3,Firewall.Policy.4
~~~~~~~

**Firewall level Medium**

~~~~~~~
    Firewall.Level.2
      Alias = "Medium"
      Name = "Medium"
      Policies = Firewall.Policy.5,Firewall.Policy.6,Firewall.Policy.7,Firewall.Policy.8
~~~~~~~

**Firewall level High**

~~~~~~~
    Firewall.Level.2
      Alias = "High"
      Name = "High"
      Policies = Firewall.Policy.9,Firewall.Policy.10,Firewall.Policy.11,Firewall.Policy.12
~~~~~~~

### Policy
The firewall policy specifies the firewall configuration between any two interfaces in a device. (Compared to the concept that a Level refers only to a single chain.) This implies that the interface configuration should no longer be specified in the `Firewall.Chain.{i}.Rule.{i}` but it should be inherited from the `Firewall.Policy.{i}` configuration.

**Firewall policies Medium**

~~~~~~~
    Firewall.Policy.5.
      Alias = "WAN2LAN"
      Enable = 1
      Status = "Enabled"
      TargetChain = "Chain"
      Chain= "Firewall.Chain.2"
      DestinationInterface = "Device.Logical.Interface.3."
      IPVersion = 0
      ReverseTargetChain = "Accept"
      ReverseChain = ""
      SourceInterface = "Device.Logical.Interface.1."
    Firewall.Policy.6.
      Alias = "WAN2GUEST"
      Enable = 1
      Status = "Enabled"
      TargetChain = "Chain"
      Chain = "Firewall.Chain.2"
      DestinationInterface = "Device.Logical.Interface.4."
      IPVersion = 0
      ReverseTargetChain = "Chain"
      ReverseChain = "Firewall.Chain.4."
      SourceInterface = "Device.Logical.Interface.1."
    Firewall.Policy.7.
      Alias="WAN2LCM"
      Enable = 1
      Status = "Enabled"
      TargetChain = "Chain"
      Chain = "Firewall.Chain.2"
      DestinationInterface = "Device.Logical.Interface.5."
      IPVersion = 0
      ReverseTargetChain = "Chain"
      ReverseChain = "Firewall.Chain.5."
      SourceInterface = "Device.Logical.Interface.1."
    Firewall.Policy.8.
      Alias = "LAN2LCM"
      Enable = 1
      Status = "Enabled"
      TargetChain = "Chain"
      Chain = "Firewall.Chain.2"
      DestinationInterface = "Device.Logical.Interface.5."
      IPVersion = 0
      ReverseTargetChain = "Chain"
      ReverseChain = "Firewall.Chain.5."
      SourceInterface = "Device.Logical.Interface.3."
~~~~~~~

As the default policy in the FORWARD chain is DROP, all FORWARD paths needs to be defined and explicitly opened if needed. A Policy is used to make this relation more clear, and allows the definition of rules for incoming and outgoing traffic.

The `Chain` parameter allows to reference a `Firewall.Chain.{i}` object where rules can be defined for traffic coming from the `SourceInterface` to the `DestinationInterface`, the `ReverseChain` parameter also allows you to provide a reference to a `Firewall.Chain.{i}` object where rules can be defined for traffic coming from the `DestinationInterface` to the `SourceInterface`.

When no rules are needed because traffic should simply be `Accepted`, `Rejected` or `Dropped` the `TargetChain` and `ReverseTargetChain` can be configured accordingly using the following options:

* **`Accept`**: The firewall forwards packets matching this rule.
* **`Reject`**: The firewall discards packets matching this rule, and sends an ICMP message to the originating host.
* **`Drop`**: The firewall discards packets matching this rule.
* **`Chain`**: The rules in the chain referenced by the ReverseChain parameter are matched.

**Firewall chain Low**

~~~~~~~
Firewall.Chain.1.
      Alias="L_Low"
      Creator="Defaults"
      Enable=1
      Name="L_Low"
      RuleNumberOfEntries=1
      Rule.1.
            Alias="cpe-Rule-1"
            CreationDate="2022-12-06T07:44:57.187868Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=-1
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=1
            Protocol=-1
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
~~~~~~~

**Firewall chain Medium**

~~~~~~~
Firewall.Chain.2.
      Alias = "L_Medium"
      Creator="Defaults"
      Enable=1
      Name="L_Medium"
      RuleNumberOfEntries=1
      Rule.1.
            Alias="cstate"
            CreationDate="2022-12-06T07:44:57.224803320Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=-1
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=1
            Protocol=-1
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState="RELATED,ESTABLISHED"
            SourceMAC=""
            SourceMACExclude=0
~~~~~~~

**Firewall chain High**

~~~~~~~
Firewall.Chain.3.
      Alias="L_High"
      Creator="Defaults"
      Enable=1
      Name="L_High"
      RuleNumberOfEntries=13
      Rule.1.
            Alias="ftp-data"
            CreationDate="2022-12-06T07:44:57.279995140Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=20
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=1
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.10.
            Alias="imap"
            CreationDate="2022-12-06T07:44:57.487939660Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=143
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=10
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.11.
            Alias="https"
            CreationDate="2022-12-06T07:44:57.527839880Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=443
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=11
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.12.
            Alias="last-tcp-rule"
            CreationDate="2022-12-06T07:44:57.561464140Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=-1
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=12
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Reject"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.13.
            Alias="last-rule"
            CreationDate="2022-12-06T07:44:57.600872040Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=-1
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=13
            Protocol=-1
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Reject"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.2.
            Alias="ftp"
            CreationDate="2022-12-06T07:44:57.321648340Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=21
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=2
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.3.
            Alias="ssh"
            CreationDate="2022-12-06T07:44:57.341043640Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=22
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=3
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.4.
            Alias="smtp"
            CreationDate="2022-12-06T07:44:57.358718120Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=25
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=4
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.5.
            Alias="dns-udp"
            CreationDate="2022-12-06T07:44:57.376790140Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=53
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=5
            Protocol=17
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.6.
            Alias="dns-tcp"
            CreationDate="2022-12-06T07:44:57.391873460Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=53
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=6
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.7.
            Alias="http"
            CreationDate="2022-12-06T07:44:57.418379220Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=80
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=7
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.8.
            Alias="pop3"
            CreationDate="2022-12-06T07:44:57.432996420Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=110
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=8
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.9.
            Alias="ntp"
            CreationDate="2022-12-06T07:44:57.463105040Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=123
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=9
            Protocol=17
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
~~~~~~~

**Firewall chain Guest**

~~~~~~~
Firewall.Chain.4.
      Alias="Guest"
      Creator="Defaults"
      Enable=1
      Name="Guest"
      RuleNumberOfEntries=5
      Rule.1.
      Rule.1.Alias="dns-udp"
            CreationDate="2022-12-06T07:44:57.663302800Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=53
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=1
            Protocol=17
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.2.
            Alias="dns-tcp"
            CreationDate="2022-12-06T07:44:57.698019980Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=53
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=2
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.3.
            Alias="http"
            CreationDate="2022-12-06T07:44:57.743905080Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=80
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=3
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.4.
            Alias="https"
            CreationDate="2022-12-06T07:44:57.784633700Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=443
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=4
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.5.
            Alias="icmp"
            CreationDate="2022-12-06T07:44:57.808069460Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=-1
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=5
            Protocol=1
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
~~~~~~~

**Firewall chain LCM**

~~~~~~~
Firewall.Chain.5.
      Alias="LCM"
      Creator="Defaults"
      Enable=1
      Name="LCM"
      RuleNumberOfEntries=5
      Rule.1.
            Alias="dns-udp"
            CreationDate="2022-12-06T07:44:57.848761260Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=53
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=1
            Protocol=17
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.2.
            Alias="dns-tcp"
            CreationDate="2022-12-06T07:44:57.885819Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=53
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=2
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.3.
            Alias="http"
            CreationDate="2022-12-06T07:44:57.903074620Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=80
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=3
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.4.
            Alias="https"
            CreationDate="2022-12-06T07:44:57.922807360Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=443
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=4
            Protocol=6
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
      Rule.5.
            Alias="icmp"
            CreationDate="2022-12-06T07:44:57.955819140Z"
            DSCP=-1
            DSCPExclude=0
            Description=""
            DestAllInterfaces=1
            DestIP=""
            DestIPExclude=0
            DestInterface=""
            DestInterfaceExclude=0
            DestMask=""
            DestPort=-1
            DestPortExclude=0
            DestPortRangeMax=-1
            Enable=1
            ExpiryDate="9999-12-31T23:59:59Z"
            IPVersion=-1
            Log=0
            Order=5
            Protocol=1
            ProtocolExclude=0
            SourceAllInterfaces=1
            SourceIP=""
            SourceIPExclude=0
            SourceInterface=""
            SourceInterfaceExclude=0
            SourceMask=""
            SourcePort=-1
            SourcePortExclude=0
            SourcePortRangeMax=-1
            Status="Enabled"
            Target="Accept"
            TargetChain=""
            ConnectionState=""
            SourceMAC=""
            SourceMACExclude=0
~~~~~~~


### Remarks
* The `Firewall.Level.{i}.Chain` parameter is no longer used.
* `Firewall.Chain.{i}.Rule.{i}` should not configure the:
  * SourceInterface
  * DestinationInterface
  * SourceInterfaceExclude
  * DestinationInterfaceExclude

as they might conflict with the Policy Interface configuration.

## DMZ example {.new-page}
This section presents a firewall example that illustrates settings corresponding to creating a DMZ rule for a DMZ host in the LAN.

![DMZ example](/images/firewall-dmz-example.svg)

Example:

~~~~~~~
    Firewall.DMZ.1
        Alias = "cpe-dmz-1"
        DestIP = "192.168.1.50"
        Interface = "Device.Logical.Interface.2."
        SourcePrefix = "8.2.1.0/24"
        Enable = 1
~~~~~~~

## Pinhole example {.new-page}
This section presents a firewall example that illustrates settings corresponding to creating a pinhole for an IP camera in the LAN.

![Pinhole example](/images/firewall-pinhole-example.svg)

Example:

~~~~~~~
    Firewall.Pinhole.1
      Alias = "cpe-pinhole-1"
      Description = "IP Camera"
      DestPort = "3343"
      Interface="Device.Logical.Interface.2."
      DestIP = "2002::10"
      Origin = "User"
      Protocol = "6,17"
      SourcePort = "3343"
      SourcePrefixes = ""
      Enable = 1
~~~~~~~

## Service example {.new-page}
This section presents a firewall example that illustrates settings corresponding to opening a local port for the DNS service provided by the device.

![Local service example](/images/firewall-service-example.svg)

Example:

~~~~~~~
    Firewall.Service.1
      Action = "Accept"
      Alias = "dns-Logical-3"
      DestinationPort = "53"
      ICMPType = -1
      IPVersion = 0
      Interface = "Device.Logical.Interface.3."
      Protocol = "6,17"
      SourcePrefix = ""
      Enable = 1
~~~~~~~
